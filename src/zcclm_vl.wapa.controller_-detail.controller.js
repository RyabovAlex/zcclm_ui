sap.ui.define([                                                                                                                                                                                                                                                
	"sap/ui/core/mvc/Controller"                                                                                                                                                                                                                                  
], function (Controller) {                                                                                                                                                                                                                                     
	"use strict";                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
	return Controller.extend("sap.cust.zcclm_vl.controller.Detail", {                                                                                                                                                                                             
		onInit: function () {                                                                                                                                                                                                                                        
			this.getOwnerComponent().getRouter().getRoute("landscape").attachPatternMatched(this.onLandscapeSelected, this);                                                                                                                                            
			this.landscapeId = null;                                                                                                                                                                                                                                    
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onAfterRendering: function () {                                                                                                                                                                                                                              
			this.getView().byId("table").setModel(this.getView().getModel());                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onDeleteLandscape: function () {                                                                                                                                                                                                                             
			if (this.landscapeId === null) {                                                                                                                                                                                                                            
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
			if (!this.deleteLandscapeDialog) {                                                                                                                                                                                                                          
				this.deleteLandscapeDialog = sap.ui.xmlfragment("sap.cust.zcclm_vl.view.DeleteLandscape", this);                                                                                                                                                           
				this.getView().addDependent(this.deleteLandscapeDialog);                                                                                                                                                                                                   
			}                                                                                                                                                                                                                                                           
			this.deleteLandscapeDialog.open();                                                                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Event handler for canceling deleting landscape transaction.                                                                                                                                                                                               
		 * Closes dialog.                                                                                                                                                                                                                                            
		 * @public&nbsp;                                                                                                                                                                                                                                             
		 */                                                                                                                                                                                                                                                          
		onCancel: function () {                                                                                                                                                                                                                                      
			this.deleteLandscapeDialog.close();                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onCancelChange: function () {                                                                                                                                                                                                                                
			this.changeLandscapeDialog.close();                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onAssignPress: function () {                                                                                                                                                                                                                                 
			if (!this.deleteLandscapeDialog) {                                                                                                                                                                                                                          
				this.deleteLandscapeDialog = sap.ui.xmlfragment("sap.cust.zcclm_vl.view.DeleteLandscape", this);                                                                                                                                                           
				this.getView().addDependent(this.deleteLandscapeDialog);                                                                                                                                                                                                   
			}                                                                                                                                                                                                                                                           
			this.deleteLandscapeDialog.open();                                                                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Deletes landscape if user confirmed.                                                                                                                                                                                                                      
		 * Closes dialog.                                                                                                                                                                                                                                            
		 * @public&nbsp;                                                                                                                                                                                                                                             
		 */                                                                                                                                                                                                                                                          
		onRemoveLandscape: function () {                                                                                                                                                                                                                             
			this.deleteLandscapeDialog.close();                                                                                                                                                                                                                         
			var eventBus = sap.ui.getCore().getEventBus();                                                                                                                                                                                                              
			eventBus.publish("listUpdate", {                                                                                                                                                                                                                            
				id: this.landscapeId                                                                                                                                                                                                                                       
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Event handler called when dialog window is closed.                                                                                                                                                                                                        
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onDeleteLandscapeDialogClose: function () {                                                                                                                                                                                                                  
			this.deleteLandscapeDialog.destroy();                                                                                                                                                                                                                       
			this.deleteLandscapeDialog = null;                                                                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onAddSystem: function () {                                                                                                                                                                                                                                   
			if (!this.addSystemDialog) {                                                                                                                                                                                                                                
				this.addSystemDialog = sap.ui.xmlfragment("sap.cust.zcclm_vl.view.AddSystem", this);                                                                                                                                                                       
				this.addSystemDialog.setModel(this.getView().getModel());                                                                                                                                                                                                  
			}                                                                                                                                                                                                                                                           
			this.addSystemDialog.open();                                                                                                                                                                                                                                
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onAddSystemDialogClose: function () {                                                                                                                                                                                                                        
			this.addSystemDialog.destroy();                                                                                                                                                                                                                             
			this.addSystemDialog = null;                                                                                                                                                                                                                                
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onChangeLandscape: function () {                                                                                                                                                                                                                             
			if (this.landscapeId === null) {                                                                                                                                                                                                                            
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
			if (!this.changeLandscapeDialog) {                                                                                                                                                                                                                          
				this.changeLandscapeDialog = sap.ui.xmlfragment("sap.cust.zcclm_vl.view.ChangeLandscape", this);                                                                                                                                                           
				this.changeLandscapeDialog.setModel(this.getView().getModel());                                                                                                                                                                                            
				sap.ui.getCore().byId("changeName").setPlaceholder(this.landscapeId);                                                                                                                                                                                      
				sap.ui.getCore().byId("changeDescription").setPlaceholder(this.descr);                                                                                                                                                                                     
				sap.ui.getCore().byId("changeName").setValue("");                                                                                                                                                                                                          
				sap.ui.getCore().byId("changeDescription").setValue("");                                                                                                                                                                                                   
			}                                                                                                                                                                                                                                                           
			this.changeLandscapeDialog.open();                                                                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onEditLandscape: function (event) {                                                                                                                                                                                                                          
			var dataModel = this.getView().getModel();                                                                                                                                                                                                                  
			var name = sap.ui.getCore().byId("changeName").getValue();                                                                                                                                                                                                  
			var desc = sap.ui.getCore().byId("changeDescription").getValue();                                                                                                                                                                                           
			var freshLandscape = {                                                                                                                                                                                                                                      
				Id: name,                                                                                                                                                                                                                                                  
				Description: desc                                                                                                                                                                                                                                          
			};                                                                                                                                                                                                                                                          
			dataModel.update("/LANDSCAPESet('" + this.landscapeId + "')", freshLandscape);                                                                                                                                                                              
			this.changeLandscapeDialog.destroy();                                                                                                                                                                                                                       
			this.changeLandscapeDialog = null;                                                                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onDeleteSystem: function () {                                                                                                                                                                                                                                
			if (!this.deleteSystemDialog) {                                                                                                                                                                                                                             
				this.deleteSystemDialog = sap.ui.xmlfragment("delfr", "sap.cust.zcclm_vl.view.DeleteSystem", this);                                                                                                                                                        
				this.getView().addDependent(this.deleteSystemDialog);                                                                                                                                                                                                      
				var dialog = sap.ui.core.Fragment.byId("delfr", "deleteSystemDialog");                                                                                                                                                                                     
				this.deleteSystemDialog.setModel(this.getView().getModel());                                                                                                                                                                                               
				var filters = [];                                                                                                                                                                                                                                          
				filters.push(new sap.ui.model.Filter("Landscapeid", sap.ui.model.FilterOperator.EQ, this.landscapeId));                                                                                                                                                    
				var template = new sap.m.StandardListItem({                                                                                                                                                                                                                
					title: "{Systemid}",                                                                                                                                                                                                                                      
					type: "Active"                                                                                                                                                                                                                                            
				});                                                                                                                                                                                                                                                        
				var bindingInfo = {                                                                                                                                                                                                                                        
					path: "/LTOSSet",                                                                                                                                                                                                                                         
					template: template,                                                                                                                                                                                                                                       
					filters: filters                                                                                                                                                                                                                                          
				};                                                                                                                                                                                                                                                         
				dialog.bindAggregation("items", bindingInfo);                                                                                                                                                                                                              
			}                                                                                                                                                                                                                                                           
			this.deleteSystemDialog.open();                                                                                                                                                                                                                             
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onDeleteSystemDialogClose: function () {                                                                                                                                                                                                                     
			this.deleteSystemDialog.destroy();                                                                                                                                                                                                                          
			this.deleteSystemDialog = null;                                                                                                                                                                                                                             
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		handleSearch: function (event) {                                                                                                                                                                                                                             
			var value = event.getParameter("value");                                                                                                                                                                                                                    
			var filter = new sap.m.Filter("Name", sap.m.StringFilterOperator.Contains, value);                                                                                                                                                                          
			var binding = event.getSource().getBinding("items");                                                                                                                                                                                                        
			binding.filter([filter]);                                                                                                                                                                                                                                   
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onAddSystemCommit: function (event) {                                                                                                                                                                                                                        
			var contexts = event.getParameter("selectedContexts");                                                                                                                                                                                                      
			var dataModel = this.getView().getModel();                                                                                                                                                                                                                  
			var extra = false;                                                                                                                                                                                                                                          
			this.extraData = {};                                                                                                                                                                                                                                        
			this.extraData["data"] = [];                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			dataModel.setUseBatch(true);                                                                                                                                                                                                                                
			for (var i = 0; i < contexts.length; ++i) {                                                                                                                                                                                                                 
				var systemId = contexts[i].getProperty("Id");                                                                                                                                                                                                              
				var landscapeId = this.landscapeId;                                                                                                                                                                                                                        
				var ltos = {                                                                                                                                                                                                                                               
					Landscapeid: landscapeId,                                                                                                                                                                                                                                 
					Systemid: systemId                                                                                                                                                                                                                                        
				};                                                                                                                                                                                                                                                         
				dataModel.create("/LTOSSet", ltos);                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
			this.addSystemDialog.destroy();                                                                                                                                                                                                                             
			this.addSystemDialog = null;                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			if (extra) {                                                                                                                                                                                                                                                
				if (!this.extraDialog) {                                                                                                                                                                                                                                   
					this.extraDialog = sap.ui.xmlfragment("sap.cust.zcclm_vl.view.Extra", this);                                                                                                                                                                              
					var model = new sap.ui.model.json.JSONModel(this.extraData);                                                                                                                                                                                              
					this.extraDialog.setModel(model);                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
				this.extraDialog.open();                                                                                                                                                                                                                                   
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			var filters = [];                                                                                                                                                                                                                                           
			filters.push(new sap.ui.model.Filter("Landscapeid", sap.ui.model.FilterOperator.EQ, "'" + this.landscapeId + "'"));                                                                                                                                         
			var sorter = [new sap.ui.model.Sorter("Landscapeid"),                                                                                                                                                                                                       
				new sap.ui.model.Sorter("Systemid"),                                                                                                                                                                                                                       
				new sap.ui.model.Sorter("Systemclient")                                                                                                                                                                                                                    
			];                                                                                                                                                                                                                                                          
			var template = new sap.m.ColumnListItem({                                                                                                                                                                                                                   
				cells: [                                                                                                                                                                                                                                                   
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{Systemid}"                                                                                                                                                                                                                                       
					}),                                                                                                                                                                                                                                                       
					new sap.m.HBox().                                                                                                                                                                                                                                         
					addItem(new sap.m.Text({                                                                                                                                                                                                                                  
						text: "{Systemrole}"                                                                                                                                                                                                                                     
					})),                                                                                                                                                                                                                                                      
					new sap.m.HBox().                                                                                                                                                                                                                                         
					addItem(new sap.m.Text({                                                                                                                                                                                                                                  
						text: "{Systemclient}"                                                                                                                                                                                                                                   
					}))                                                                                                                                                                                                                                                       
				],                                                                                                                                                                                                                                                         
				vAlign: "Middle"                                                                                                                                                                                                                                           
			});                                                                                                                                                                                                                                                         
			var bindingInfo = {                                                                                                                                                                                                                                         
				path: "/LTOSSet",                                                                                                                                                                                                                                          
				template: template,                                                                                                                                                                                                                                        
				filters: filters,                                                                                                                                                                                                                                          
				sorter: sorter                                                                                                                                                                                                                                             
			};                                                                                                                                                                                                                                                          
			this.getView().byId("table").bindItems(bindingInfo);                                                                                                                                                                                                        
			this.getView().byId("table").bindItems(bindingInfo);                                                                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onCloseExtra: function (event) {                                                                                                                                                                                                                             
			this.extraDialog.destroy();                                                                                                                                                                                                                                 
			this.extraDialog = null;                                                                                                                                                                                                                                    
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onSystemDelete: function (event) {                                                                                                                                                                                                                           
			var contexts = event.getParameter("selectedContexts");                                                                                                                                                                                                      
			var dataModel = this.getView().getModel();                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
			dataModel.setUseBatch(true);                                                                                                                                                                                                                                
			for (var i = 0; i < contexts.length; ++i) {                                                                                                                                                                                                                 
				var systemId = contexts[i].getProperty("Systemid");                                                                                                                                                                                                        
				var landscapeId = this.landscapeId;                                                                                                                                                                                                                        
				dataModel.remove("/LTOSSet(Landscapeid='" + landscapeId + "',Systemid='" + systemId + "')");                                                                                                                                                               
			}                                                                                                                                                                                                                                                           
			this.deleteSystemDialog.destroy();                                                                                                                                                                                                                          
			this.deleteSystemDialog = null;                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
			var filters = [];                                                                                                                                                                                                                                           
			filters.push(new sap.ui.model.Filter("Landscapeid", sap.ui.model.FilterOperator.EQ, this.landscapeId));                                                                                                                                                     
			var sorter = [new sap.ui.model.Sorter("Landscapeid"),                                                                                                                                                                                                       
				new sap.ui.model.Sorter("Systemid"),                                                                                                                                                                                                                       
				new sap.ui.model.Sorter("Systemclient")                                                                                                                                                                                                                    
			];                                                                                                                                                                                                                                                          
			var template = new sap.m.ColumnListItem({                                                                                                                                                                                                                   
				cells: [                                                                                                                                                                                                                                                   
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{Systemid}"                                                                                                                                                                                                                                       
					}),                                                                                                                                                                                                                                                       
					new sap.m.HBox().                                                                                                                                                                                                                                         
					addItem(new sap.m.Text({                                                                                                                                                                                                                                  
						text: "{Systemrole}"                                                                                                                                                                                                                                     
					})),                                                                                                                                                                                                                                                      
					new sap.m.HBox().                                                                                                                                                                                                                                         
					addItem(new sap.m.Text({                                                                                                                                                                                                                                  
						text: "{Systemclient}"                                                                                                                                                                                                                                   
					}))                                                                                                                                                                                                                                                       
				],                                                                                                                                                                                                                                                         
				vAlign: "Middle"                                                                                                                                                                                                                                           
			});                                                                                                                                                                                                                                                         
			var bindingInfo = {                                                                                                                                                                                                                                         
				path: "/LTOSSet",                                                                                                                                                                                                                                          
				template: template,                                                                                                                                                                                                                                        
				filters: filters,                                                                                                                                                                                                                                          
				sorter: sorter                                                                                                                                                                                                                                             
			};                                                                                                                                                                                                                                                          
			this.getView().byId("table").bindItems(bindingInfo);                                                                                                                                                                                                        
			this.getView().byId("table").bindItems(bindingInfo);                                                                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onLandscapeSelected: function (event) {                                                                                                                                                                                                                      
			this.landscapeId = event.getParameter("arguments").Id;                                                                                                                                                                                                      
			this.descr = event.getParameter("arguments").Descr;                                                                                                                                                                                                         
			var filters = [];                                                                                                                                                                                                                                           
			filters.push(new sap.ui.model.Filter("Landscapeid", sap.ui.model.FilterOperator.EQ, this.landscapeId));                                                                                                                                                     
			var sorter = [new sap.ui.model.Sorter("Landscapeid"), new sap.ui.model.Sorter("Systemid")];                                                                                                                                                                 
			var template = new sap.m.ColumnListItem({                                                                                                                                                                                                                   
				cells: [                                                                                                                                                                                                                                                   
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{Systemid}"                                                                                                                                                                                                                                       
					}),                                                                                                                                                                                                                                                       
					new sap.m.HBox().                                                                                                                                                                                                                                         
					addItem(new sap.m.Text({                                                                                                                                                                                                                                  
						text: "{Systemrole}"                                                                                                                                                                                                                                     
					})),                                                                                                                                                                                                                                                      
					new sap.m.HBox().                                                                                                                                                                                                                                         
					addItem(new sap.m.Text({                                                                                                                                                                                                                                  
						text: "{Systemclient}"                                                                                                                                                                                                                                   
					}))                                                                                                                                                                                                                                                       
				],                                                                                                                                                                                                                                                         
				vAlign: "Middle"                                                                                                                                                                                                                                           
			});                                                                                                                                                                                                                                                         
			var bindingInfo = {                                                                                                                                                                                                                                         
				path: "/LTOSSet",                                                                                                                                                                                                                                          
				template: template,                                                                                                                                                                                                                                        
				filters: filters,                                                                                                                                                                                                                                          
				sorter: sorter                                                                                                                                                                                                                                             
			};                                                                                                                                                                                                                                                          
			this.getView().byId("table").bindItems(bindingInfo);                                                                                                                                                                                                        
			this.getView().byId("table").bindItems(bindingInfo);                                                                                                                                                                                                        
			this.getView().byId("table").attachUpdateFinished(this.addSelection.bind(this));                                                                                                                                                                            
                                                                                                                                                                                                                                                               
			filters = [];                                                                                                                                                                                                                                               
			filters.push(new sap.ui.model.Filter("LnscpId", sap.ui.model.FilterOperator.EQ, this.landscapeId));                                                                                                                                                         
			sorter = [new sap.ui.model.Sorter("LnscpId")];                                                                                                                                                                                                              
			template = new sap.m.ColumnListItem({                                                                                                                                                                                                                       
				cells: [                                                                                                                                                                                                                                                   
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{Mail}"                                                                                                                                                                                                                                           
					})                                                                                                                                                                                                                                                        
				],                                                                                                                                                                                                                                                         
				vAlign: "Middle"                                                                                                                                                                                                                                           
			});                                                                                                                                                                                                                                                         
			bindingInfo = {                                                                                                                                                                                                                                             
				path: "/MAILSet",                                                                                                                                                                                                                                          
				template: template,                                                                                                                                                                                                                                        
				filters: filters,                                                                                                                                                                                                                                          
				sorter: sorter                                                                                                                                                                                                                                             
			};                                                                                                                                                                                                                                                          
			this.getView().byId("idMailTable").bindItems(bindingInfo);                                                                                                                                                                                                  
			this.getView().byId("idMailTable").bindItems(bindingInfo);                                                                                                                                                                                                  
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		addSelection: function (event) {                                                                                                                                                                                                                             
			var table = event.getSource();                                                                                                                                                                                                                              
			var rows = table.getItems();                                                                                                                                                                                                                                
			for (var i = 0; i < rows.length; ++i) {                                                                                                                                                                                                                     
				var hbox = rows[i].getCells()[1];                                                                                                                                                                                                                          
				var text = hbox.getItems()[0].getText();                                                                                                                                                                                                                   
				if (text.length === 0) {                                                                                                                                                                                                                                   
					text = "Undefined";                                                                                                                                                                                                                                       
				}                                                                                                                                                                                                                                                          
				hbox.destroyItems();                                                                                                                                                                                                                                       
				var newtext = new sap.m.Text();                                                                                                                                                                                                                            
				newtext.setText(text);                                                                                                                                                                                                                                     
				newtext.setVisible(true);                                                                                                                                                                                                                                  
				hbox.addItem(newtext);                                                                                                                                                                                                                                     
				var selection = new sap.m.Select();                                                                                                                                                                                                                        
				selection.addItem(new sap.ui.core.Item({                                                                                                                                                                                                                   
					key: "U",                                                                                                                                                                                                                                                 
					text: "Undefined"                                                                                                                                                                                                                                         
				}));                                                                                                                                                                                                                                                       
				selection.addItem(new sap.ui.core.Item({                                                                                                                                                                                                                   
					key: "D",                                                                                                                                                                                                                                                 
					text: "DEV"                                                                                                                                                                                                                                               
				}));                                                                                                                                                                                                                                                       
				selection.addItem(new sap.ui.core.Item({                                                                                                                                                                                                                   
					key: "Q",                                                                                                                                                                                                                                                 
					text: "QA"                                                                                                                                                                                                                                                
				}));                                                                                                                                                                                                                                                       
				selection.addItem(new sap.ui.core.Item({                                                                                                                                                                                                                   
					key: "P",                                                                                                                                                                                                                                                 
					text: "PROD"                                                                                                                                                                                                                                              
				}));                                                                                                                                                                                                                                                       
				selection.setVisible(false);                                                                                                                                                                                                                               
				selection.attachChange(function (oEvent) {                                                                                                                                                                                                                 
					var data = oEvent.getSource().getParent().getItems();                                                                                                                                                                                                     
					var systemId = oEvent.getSource().getParent().getParent().getCells()[0].getText();                                                                                                                                                                        
					var txt = data[1].getSelectedItem().getText();                                                                                                                                                                                                            
					var path = "/SYSTEMSet('" + systemId + "')";                                                                                                                                                                                                              
					this.getModel().update(path, {                                                                                                                                                                                                                            
						Id: systemId,                                                                                                                                                                                                                                            
						Role: txt                                                                                                                                                                                                                                                
					});                                                                                                                                                                                                                                                       
					data[0].setText(txt);                                                                                                                                                                                                                                     
				});                                                                                                                                                                                                                                                        
				selection.addStyleClass("sapUiSmallMarginBeginEnd");                                                                                                                                                                                                       
				hbox.addItem(selection);                                                                                                                                                                                                                                   
				var button = new sap.m.Button();                                                                                                                                                                                                                           
				button.setIcon("sap-icon://edit");                                                                                                                                                                                                                         
				button.setType(sap.m.ButtonType.Transparent);                                                                                                                                                                                                              
				button.attachPress(function (oEvent) {                                                                                                                                                                                                                     
					var data = oEvent.getSource().getParent().getItems();                                                                                                                                                                                                     
					if (data[0].getVisible()) {                                                                                                                                                                                                                               
						data[1].setSelectedKey(data[0].getText()[0]);                                                                                                                                                                                                            
						data[0].setVisible(false);                                                                                                                                                                                                                               
						data[1].setVisible(true);                                                                                                                                                                                                                                
						data[2].setIcon("sap-icon://accept");                                                                                                                                                                                                                    
					} else {                                                                                                                                                                                                                                                  
						data[0].setVisible(true);                                                                                                                                                                                                                                
						data[1].setVisible(false);                                                                                                                                                                                                                               
						data[2].setIcon("sap-icon://edit");                                                                                                                                                                                                                      
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
				hbox.addItem(button);                                                                                                                                                                                                                                      
				hbox.addStyleClass("sapUiSmallMarginBeginEnd").setAlignItems(sap.m.FlexAlignItems.Center);                                                                                                                                                                 
                                                                                                                                                                                                                                                               
				hbox = rows[i].getCells()[2];                                                                                                                                                                                                                              
				text = hbox.getItems()[0].getText();                                                                                                                                                                                                                       
				hbox.destroyItems();                                                                                                                                                                                                                                       
				newtext = new sap.m.Text();                                                                                                                                                                                                                                
				newtext.setText(text);                                                                                                                                                                                                                                     
				newtext.setVisible(true);                                                                                                                                                                                                                                  
				hbox.addItem(newtext);                                                                                                                                                                                                                                     
				var input = new sap.m.Input({                                                                                                                                                                                                                              
					maxLength: 3                                                                                                                                                                                                                                              
				});                                                                                                                                                                                                                                                        
				input.setVisible(false);                                                                                                                                                                                                                                   
				input.attachChange(function (oEvent) {                                                                                                                                                                                                                     
					var data = oEvent.getSource().getParent().getItems();                                                                                                                                                                                                     
					var systemId = oEvent.getSource().getParent().getParent().getCells()[0].getText();                                                                                                                                                                        
					var txt = data[1].getValue();                                                                                                                                                                                                                             
					var path = "/LTOSSet(Landscapeid='" + this.landscapeId + "',Systemid='" + systemId + "')";                                                                                                                                                                
					this.getView().getModel().update(path, {                                                                                                                                                                                                                  
						Systemid: systemId,                                                                                                                                                                                                                                      
						Landscapeid: this.landscapeId,                                                                                                                                                                                                                           
						Systemclient: txt                                                                                                                                                                                                                                        
					});                                                                                                                                                                                                                                                       
					data[0].setText(text);                                                                                                                                                                                                                                    
				}.bind(this));                                                                                                                                                                                                                                             
				input.addStyleClass("sapUiSmallMarginBeginEnd");                                                                                                                                                                                                           
				hbox.addItem(input);                                                                                                                                                                                                                                       
				button = new sap.m.Button();                                                                                                                                                                                                                               
				button.setIcon("sap-icon://edit");                                                                                                                                                                                                                         
				button.setType(sap.m.ButtonType.Transparent);                                                                                                                                                                                                              
				button.attachPress(function (oEvent) {                                                                                                                                                                                                                     
					var data = oEvent.getSource().getParent().getItems();                                                                                                                                                                                                     
					if (data[0].getVisible()) {                                                                                                                                                                                                                               
						data[1].setValue(data[0].getText());                                                                                                                                                                                                                     
						data[0].setVisible(false);                                                                                                                                                                                                                               
						data[1].setVisible(true);                                                                                                                                                                                                                                
						data[2].setIcon("sap-icon://accept");                                                                                                                                                                                                                    
					} else {                                                                                                                                                                                                                                                  
						data[0].setVisible(true);                                                                                                                                                                                                                                
						data[1].setVisible(false);                                                                                                                                                                                                                               
						data[2].setIcon("sap-icon://edit");                                                                                                                                                                                                                      
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
				hbox.addItem(button);                                                                                                                                                                                                                                      
				hbox.addStyleClass("sapUiSmallMarginBeginEnd").setAlignItems(sap.m.FlexAlignItems.Center);                                                                                                                                                                 
                                                                                                                                                                                                                                                               
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onAddMail: function () {                                                                                                                                                                                                                                     
			if (!this.addMailDialog) {                                                                                                                                                                                                                                  
				this.addMailDialog = sap.ui.xmlfragment("sap.cust.zcclm_vl.view.Mail", this);                                                                                                                                                                              
				this.addMailDialog.setModel(this.getView().getModel());                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
			this.addMailDialog.open();                                                                                                                                                                                                                                  
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onAddMailDialogClose: function () {                                                                                                                                                                                                                          
			this.addMailDialog.destroy();                                                                                                                                                                                                                               
			this.addMailDialog = null;                                                                                                                                                                                                                                  
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onAddMailCommit: function (event) {                                                                                                                                                                                                                          
			var dataModel = this.getView().getModel();                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
			//Commit&nbsp;                                                                                                                                                                                                                                              
			var mail = sap.ui.getCore().byId("newMail").getValue();                                                                                                                                                                                                     
			var freshMail = {                                                                                                                                                                                                                                           
				LnscpId: this.landscapeId,                                                                                                                                                                                                                                 
				Mail: mail                                                                                                                                                                                                                                                 
			};                                                                                                                                                                                                                                                          
			dataModel.create("/MAILSet", freshMail);                                                                                                                                                                                                                    
			//                                                                                                                                                                                                                                                          
			var filters = [];                                                                                                                                                                                                                                           
			filters.push(new sap.ui.model.Filter("LnscpId", sap.ui.model.FilterOperator.EQ, this.landscapeId));                                                                                                                                                         
			var sorter = [new sap.ui.model.Sorter("LnscpId")];                                                                                                                                                                                                          
			var template = new sap.m.ColumnListItem({                                                                                                                                                                                                                   
				cells: [                                                                                                                                                                                                                                                   
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{Mail}"                                                                                                                                                                                                                                           
					})                                                                                                                                                                                                                                                        
				],                                                                                                                                                                                                                                                         
				vAlign: "Middle"                                                                                                                                                                                                                                           
			});                                                                                                                                                                                                                                                         
			var bindingInfo = {                                                                                                                                                                                                                                         
				path: "/MAILSet",                                                                                                                                                                                                                                          
				template: template,                                                                                                                                                                                                                                        
				filters: filters,                                                                                                                                                                                                                                          
				sorter: sorter                                                                                                                                                                                                                                             
			};                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			this.addMailDialog.destroy();                                                                                                                                                                                                                               
			this.addMailDialog = null;                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
			this.getView().byId("idMailTable").bindItems(bindingInfo);                                                                                                                                                                                                  
			this.getView().byId("idMailTable").bindItems(bindingInfo);                                                                                                                                                                                                  
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onDeleteMail: function () {                                                                                                                                                                                                                                  
			if (!this.deleteMailDialog) {                                                                                                                                                                                                                               
				this.deleteMailDialog = sap.ui.xmlfragment("delMail", "sap.cust.zcclm_vl.view.DeleteMail", this);                                                                                                                                                          
				this.getView().addDependent(this.deleteSystemDialog);                                                                                                                                                                                                      
				var dialog = sap.ui.core.Fragment.byId("delMail", "deleteMailDialog");                                                                                                                                                                                     
				this.deleteMailDialog.setModel(this.getView().getModel());                                                                                                                                                                                                 
				var filters = [];                                                                                                                                                                                                                                          
				filters.push(new sap.ui.model.Filter("LnscpId", sap.ui.model.FilterOperator.EQ, this.landscapeId));                                                                                                                                                        
				var template = new sap.m.StandardListItem({                                                                                                                                                                                                                
					title: "{Mail}",                                                                                                                                                                                                                                          
					type: "Active"                                                                                                                                                                                                                                            
				});                                                                                                                                                                                                                                                        
				var bindingInfo = {                                                                                                                                                                                                                                        
					path: "/MAILSet",                                                                                                                                                                                                                                         
					template: template,                                                                                                                                                                                                                                       
					filters: filters                                                                                                                                                                                                                                          
				};                                                                                                                                                                                                                                                         
				dialog.bindAggregation("items", bindingInfo);                                                                                                                                                                                                              
			}                                                                                                                                                                                                                                                           
			this.deleteMailDialog.open();                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onMailDelete: function (event) {                                                                                                                                                                                                                             
			var contexts = event.getParameter("selectedContexts");                                                                                                                                                                                                      
			var dataModel = this.getView().getModel();                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
			dataModel.setUseBatch(true);                                                                                                                                                                                                                                
			for (var i = 0; i < contexts.length; ++i) {                                                                                                                                                                                                                 
				var mail = contexts[i].getProperty("Mail");                                                                                                                                                                                                                
				var landscapeId = this.landscapeId;                                                                                                                                                                                                                        
				dataModel.remove("/MAILSet(LnscpId='" + landscapeId + "',Mail='" + mail + "')");                                                                                                                                                                           
			}                                                                                                                                                                                                                                                           
			this.deleteSystemDialog.destroy();                                                                                                                                                                                                                          
			this.deleteSystemDialog = null;                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
			var filters = [];                                                                                                                                                                                                                                           
			filters.push(new sap.ui.model.Filter("LnscpId", sap.ui.model.FilterOperator.EQ, this.landscapeId));                                                                                                                                                         
			var sorter = [new sap.ui.model.Sorter("LnscpId"),                                                                                                                                                                                                           
				new sap.ui.model.Sorter("Mail")                                                                                                                                                                                                                            
			];                                                                                                                                                                                                                                                          
			var template = new sap.m.StandardListItem({                                                                                                                                                                                                                 
				title: "{Mail}",                                                                                                                                                                                                                                           
				type: "Active"                                                                                                                                                                                                                                             
			});                                                                                                                                                                                                                                                         
			var bindingInfo = {                                                                                                                                                                                                                                         
				path: "/MAILSet",                                                                                                                                                                                                                                          
				template: template,                                                                                                                                                                                                                                        
				filters: filters,                                                                                                                                                                                                                                          
				sorter: sorter                                                                                                                                                                                                                                             
			};                                                                                                                                                                                                                                                          
			this.getView().byId("idMailTable").bindItems(bindingInfo);                                                                                                                                                                                                  
			this.getView().byId("idMailTable").bindItems(bindingInfo);                                                                                                                                                                                                  
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onDeleteMailDialogClose: function () {                                                                                                                                                                                                                       
			this.deleteMailDialog.destroy();                                                                                                                                                                                                                            
			this.deleteMailDialog = null;                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onType: function (event) {                                                                                                                                                                                                                                   
			var text = event.getParameter('value');                                                                                                                                                                                                                     
			this.addMailDialog.getBeginButton().setEnabled(text.length > 0);                                                                                                                                                                                            
		}                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
	});                                                                                                                                                                                                                                                           
});                                                                                                                                                                                                                                                            