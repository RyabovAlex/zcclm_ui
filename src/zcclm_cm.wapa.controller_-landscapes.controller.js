sap.ui.define(["sap/ui/core/mvc/Controller"], function (Controller) {                                                                                                                                                                                          
	"use strict";                                                                                                                                                                                                                                                 
	return Controller.extend("sap.cust.zcclm_cm.controller.Landscapes", {                                                                                                                                                                                         
		onInit: function () {                                                                                                                                                                                                                                        
			this.landscapesTable = this.getView().byId("idLandscapesTable");                                                                                                                                                                                            
			this._oPopover = new sap.ui.xmlfragment("sap.cust.zcclm_cm.view.SolmanJobPopover", this);                                                                                                                                                                   
			this.getView().addDependent(this._oPopover);                                                                                                                                                                                                                
		},                                                                                                                                                                                                                                                           
		onLandscapeSelection: function (event) {                                                                                                                                                                                                                     
			var context = event.getSource().getSelectedItem().getBindingContext();                                                                                                                                                                                      
			var landscapeId = context.getProperty("LandscapeId");                                                                                                                                                                                                       
			if (landscapeId) {                                                                                                                                                                                                                                          
				this.getOwnerComponent().getRouter().navTo("Systems", {                                                                                                                                                                                                    
					Id: landscapeId                                                                                                                                                                                                                                           
				});                                                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		onSolmanJobPress: function (event) {                                                                                                                                                                                                                         
			var table = this._oPopover.getContent()[0];                                                                                                                                                                                                                 
			this.src = event.getSource();                                                                                                                                                                                                                               
			table.attachUpdateFinished({}, this.openPopover, this);                                                                                                                                                                                                     
			var template = new sap.m.ColumnListItem({                                                                                                                                                                                                                   
				cells: [                                                                                                                                                                                                                                                   
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{Jobname}"                                                                                                                                                                                                                                        
					}),                                                                                                                                                                                                                                                       
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{Start}"                                                                                                                                                                                                                                          
					}),                                                                                                                                                                                                                                                       
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{Period}"                                                                                                                                                                                                                                         
					}),                                                                                                                                                                                                                                                       
					new sap.ui.core.Icon({                                                                                                                                                                                                                                    
						src: {                                                                                                                                                                                                                                                   
							path: "Status",                                                                                                                                                                                                                                         
							formatter: this.getIconTypeExt                                                                                                                                                                                                                          
						},                                                                                                                                                                                                                                                       
						color: {                                                                                                                                                                                                                                                 
							path: "Status",                                                                                                                                                                                                                                         
							formatter: this.getIconColorExt                                                                                                                                                                                                                         
						},                                                                                                                                                                                                                                                       
						size: "2em"                                                                                                                                                                                                                                              
					})                                                                                                                                                                                                                                                        
				]                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			var filters = [];                                                                                                                                                                                                                                           
			filters.push(new sap.ui.model.Filter("Jobname", sap.ui.model.FilterOperator.EQ, event.getSource().getCells()[0].getText()));                                                                                                                                
			var bindingInfo = {                                                                                                                                                                                                                                         
				path: "/SOLMAN_JOB_RUNSet",                                                                                                                                                                                                                                
				template: template,                                                                                                                                                                                                                                        
				filters: filters                                                                                                                                                                                                                                           
			};                                                                                                                                                                                                                                                          
			table.bindItems(bindingInfo);                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		/*onBPPress: function (event) {                                                                                                                                                                                                                              
		this.getOwnerComponent().getRouter().navTo("BestPractice");                                                                                                                                                                                                  
		},*/                                                                                                                                                                                                                                                         
		getIconType: function (level) {                                                                                                                                                                                                                              
			switch (level) {                                                                                                                                                                                                                                            
			case 0:                                                                                                                                                                                                                                                     
				return "sap-icon://message-success";                                                                                                                                                                                                                       
			case 1:                                                                                                                                                                                                                                                     
				return "sap-icon://message-warning";                                                                                                                                                                                                                       
			case 2:                                                                                                                                                                                                                                                     
				return "sap-icon://message-error";                                                                                                                                                                                                                         
			default:                                                                                                                                                                                                                                                    
				return "sap-icon://sys-help";                                                                                                                                                                                                                              
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		getIconColor: function (level) {                                                                                                                                                                                                                             
			switch (level) {                                                                                                                                                                                                                                            
			case 0:                                                                                                                                                                                                                                                     
				return "#2b7d2b";                                                                                                                                                                                                                                          
			case 1:                                                                                                                                                                                                                                                     
				return "#e78c07";                                                                                                                                                                                                                                          
			case 2:                                                                                                                                                                                                                                                     
				return "#bb0000";                                                                                                                                                                                                                                          
			default:                                                                                                                                                                                                                                                    
				return "#000000";                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		getIconTypeBW: function (status) {                                                                                                                                                                                                                           
			return status === "X" ? "sap-icon://message-success" : "sap-icon://message-error";                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
		getIconColorBW: function (status) {                                                                                                                                                                                                                          
			return status === "X" ? "#2b7d2b" : "#bb0000";                                                                                                                                                                                                              
		},                                                                                                                                                                                                                                                           
		getIconTypeJob: function (status) {                                                                                                                                                                                                                          
			return status === "S" ? "sap-icon://message-success" : "sap-icon://message-error";                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
		getIconColorJob: function (status) {                                                                                                                                                                                                                         
			return status === "S" ? "#2b7d2b" : "#bb0000";                                                                                                                                                                                                              
		},                                                                                                                                                                                                                                                           
		getIconTypeExt: function (status) {                                                                                                                                                                                                                          
			if (status === "F") {                                                                                                                                                                                                                                       
				return "sap-icon://message-success";                                                                                                                                                                                                                       
			}                                                                                                                                                                                                                                                           
			if (status === "R") {                                                                                                                                                                                                                                       
				return "sap-icon://message-warning";                                                                                                                                                                                                                       
			}                                                                                                                                                                                                                                                           
			if (status === "A") {                                                                                                                                                                                                                                       
				return "sap-icon://message-error";                                                                                                                                                                                                                         
			}                                                                                                                                                                                                                                                           
			return "";                                                                                                                                                                                                                                                  
		},                                                                                                                                                                                                                                                           
		getIconColorExt: function (status) {                                                                                                                                                                                                                         
			if (status === "F") {                                                                                                                                                                                                                                       
				return "#2b7d2b";                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
			if (status === "R") {                                                                                                                                                                                                                                       
				return "#e78c07";                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
			if (status === "A") {                                                                                                                                                                                                                                       
				return "#bb0000";                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
			return "#000000";                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		openPopover: function () {                                                                                                                                                                                                                                   
			this._oPopover.openBy(this.src);                                                                                                                                                                                                                            
		},                                                                                                                                                                                                                                                           
		onPopoverClose: function () {                                                                                                                                                                                                                                
			this._oPopover.close();                                                                                                                                                                                                                                     
		},                                                                                                                                                                                                                                                           
		onUpdPress: function (event) {                                                                                                                                                                                                                               
			this.getView().getModel().callFunction("/MASS_UPDATE", "POST", // http method                                                                                                                                                                               
				{}, // function import parameters                                                                                                                                                                                                                          
				null,                                                                                                                                                                                                                                                      
				function (oData, response) {                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
				}, // callback function for success                                                                                                                                                                                                                        
				function (oError) {});                                                                                                                                                                                                                                     
			sap.m.MessageToast.show("Background job 'ZCCLM_STATUS_UPDATE' was scheduled. Landscapes status will be updated");                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 *@memberOf sap.cust.zcclm_cm.controller.Landscapes                                                                                                                                                                                                          
		 */                                                                                                                                                                                                                                                          
		action: function (oEvent) {                                                                                                                                                                                                                                  
			var that = this;                                                                                                                                                                                                                                            
			var actionParameters = JSON.parse(oEvent.getSource().data("wiring").replace(/'/g, "\""));                                                                                                                                                                   
			var eventType = oEvent.getId();                                                                                                                                                                                                                             
			var aTargets = actionParameters[eventType].targets || [];                                                                                                                                                                                                   
			aTargets.forEach(function (oTarget) {                                                                                                                                                                                                                       
				var oControl = that.byId(oTarget.id);                                                                                                                                                                                                                      
				if (oControl) {                                                                                                                                                                                                                                            
					var oParams = {};                                                                                                                                                                                                                                         
					for (var prop in oTarget.parameters) {                                                                                                                                                                                                                    
						oParams[prop] = oEvent.getParameter(oTarget.parameters[prop]);                                                                                                                                                                                           
					}                                                                                                                                                                                                                                                         
					oControl[oTarget.action](oParams);                                                                                                                                                                                                                        
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			var oNavigation = actionParameters[eventType].navigation;                                                                                                                                                                                                   
			if (oNavigation) {                                                                                                                                                                                                                                          
				var oParams = {};                                                                                                                                                                                                                                          
				(oNavigation.keys || []).forEach(function (prop) {                                                                                                                                                                                                         
					oParams[prop.name] = encodeURIComponent(JSON.stringify({                                                                                                                                                                                                  
						value: oEvent.getSource().getBindingContext(oNavigation.model).getProperty(prop.name),                                                                                                                                                                   
						type: prop.type                                                                                                                                                                                                                                          
					}));                                                                                                                                                                                                                                                      
				});                                                                                                                                                                                                                                                        
				if (Object.getOwnPropertyNames(oParams).length !== 0) {                                                                                                                                                                                                    
					this.getOwnerComponent().getRouter().navTo(oNavigation.routeName, oParams);                                                                                                                                                                               
				} else {                                                                                                                                                                                                                                                   
					this.getOwnerComponent().getRouter().navTo(oNavigation.routeName);                                                                                                                                                                                        
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
		}                                                                                                                                                                                                                                                            
	});                                                                                                                                                                                                                                                           
});                                                                                                                                                                                                                                                            