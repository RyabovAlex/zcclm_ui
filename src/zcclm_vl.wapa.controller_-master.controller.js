sap.ui.define([                                                                                                                                                                                                                                                
	"sap/ui/core/mvc/Controller",                                                                                                                                                                                                                                 
	"sap/ui/model/json/JSONModel"                                                                                                                                                                                                                                 
], function (Controller, JSONModel) {                                                                                                                                                                                                                          
	"use strict";                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
	return Controller.extend("sap.cust.zcclm_vl.controller.Master", {                                                                                                                                                                                             
		onInit: function () {                                                                                                                                                                                                                                        
			var eventBus = sap.ui.getCore().getEventBus();                                                                                                                                                                                                              
			eventBus.subscribe("listUpdate", this.onUpdate, this);                                                                                                                                                                                                      
		},                                                                                                                                                                                                                                                           
		onSelectionChange: function (event) {                                                                                                                                                                                                                        
			var landscape = event.getSource().getSelectedItem().getBindingContext().getProperty("Id");                                                                                                                                                                  
			var desc = event.getSource().getSelectedItem().getBindingContext().getProperty("Descr");                                                                                                                                                                    
			this.getOwnerComponent().getRouter()                                                                                                                                                                                                                        
				.navTo("landscape", {                                                                                                                                                                                                                                      
					Id: landscape,                                                                                                                                                                                                                                            
					Descr: desc                                                                                                                                                                                                                                               
				});                                                                                                                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onAddLandscape: function (event) {                                                                                                                                                                                                                           
			if (!this.addLandscapeDialog) {                                                                                                                                                                                                                             
				this.addLandscapeDialog = sap.ui.xmlfragment("sap.cust.zcclm_vl.view.AddLandscape", this);                                                                                                                                                                 
				this.getView().addDependent(this.addLandscapeDialog);                                                                                                                                                                                                      
			}                                                                                                                                                                                                                                                           
			this.addLandscapeDialog.open();                                                                                                                                                                                                                             
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onType: function (event) {                                                                                                                                                                                                                                   
			var text = event.getParameter('value');                                                                                                                                                                                                                     
			this.addLandscapeDialog.getBeginButton().setEnabled(text.length > 0);                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onCancel: function () {                                                                                                                                                                                                                                      
			this.addLandscapeDialog.close();                                                                                                                                                                                                                            
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onSubmitChange: function () {                                                                                                                                                                                                                                
			var dataModel = this.getView().byId("list").getModel();                                                                                                                                                                                                     
			var name = sap.ui.getCore().byId("changeName").getValue();                                                                                                                                                                                                  
			var desc = sap.ui.getCore().byId("changeDescription").getValue();                                                                                                                                                                                           
			var freshLandscape = {                                                                                                                                                                                                                                      
				Id: name,                                                                                                                                                                                                                                                  
				Description: desc                                                                                                                                                                                                                                          
			};                                                                                                                                                                                                                                                          
			dataModel.update("/LANDSCAPESet", freshLandscape);                                                                                                                                                                                                          
			this.changeLandscapeDialog.close();                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onCommitLandscape: function () {                                                                                                                                                                                                                             
			var dataModel = this.getView().byId("list").getModel();                                                                                                                                                                                                     
			var name = sap.ui.getCore().byId("newName").getValue();                                                                                                                                                                                                     
			var desc = sap.ui.getCore().byId("newDescription").getValue();                                                                                                                                                                                              
			var freshLandscape = {                                                                                                                                                                                                                                      
				Id: name,                                                                                                                                                                                                                                                  
				Description: desc                                                                                                                                                                                                                                          
			};                                                                                                                                                                                                                                                          
			dataModel.create("/LANDSCAPESet", freshLandscape);                                                                                                                                                                                                          
			this.addLandscapeDialog.close();                                                                                                                                                                                                                            
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onDialogClose: function () {                                                                                                                                                                                                                                 
			this.addLandscapeDialog.destroy();                                                                                                                                                                                                                          
			this.addLandscapeDialog = null;                                                                                                                                                                                                                             
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onRefresh: function (event) {                                                                                                                                                                                                                                
			var that = this;                                                                                                                                                                                                                                            
			setTimeout(jQuery.proxy(function () {                                                                                                                                                                                                                       
				that.getView().byId("list").getModel().refresh(true);                                                                                                                                                                                                      
			}), 1000);                                                                                                                                                                                                                                                  
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onSearch: function (event) {                                                                                                                                                                                                                                 
			var query = event.getSource().getValue();                                                                                                                                                                                                                   
			if (query && query.length > 0) {                                                                                                                                                                                                                            
				var filters = [new sap.ui.model.Filter("Id", sap.ui.model.FilterOperator.EQ, query)];                                                                                                                                                                      
			}                                                                                                                                                                                                                                                           
			var list = this.getView().byId("list");                                                                                                                                                                                                                     
			list.bindItems({                                                                                                                                                                                                                                            
				path: "/LANDSCAPESet",                                                                                                                                                                                                                                     
				filters: filters,                                                                                                                                                                                                                                          
				template: new sap.m.ObjectListItem({                                                                                                                                                                                                                       
					title: "{Id}",                                                                                                                                                                                                                                            
					attributes: [                                                                                                                                                                                                                                             
						new sap.m.ObjectAttribute({                                                                                                                                                                                                                              
							text: "{Description}"                                                                                                                                                                                                                                   
						})                                                                                                                                                                                                                                                       
					]                                                                                                                                                                                                                                                         
				})                                                                                                                                                                                                                                                         
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onUpdate: function (channel, event, data) {                                                                                                                                                                                                                  
			if (event === "listUpdate") {                                                                                                                                                                                                                               
				var dataModel = this.getView().byId("list").getModel();                                                                                                                                                                                                    
				var id = data.id;                                                                                                                                                                                                                                          
				dataModel.remove("/LANDSCAPESet('" + id + "')");                                                                                                                                                                                                           
				var list = this.getView().byId("list");                                                                                                                                                                                                                    
				list.setModel(dataModel);                                                                                                                                                                                                                                  
				list.getBinding("items").refresh();                                                                                                                                                                                                                        
				list.setSelectedItem(list.getItems()[0], true, true);                                                                                                                                                                                                      
				this.getOwnerComponent().getRouter()                                                                                                                                                                                                                       
					.navTo("landscape", {                                                                                                                                                                                                                                     
						Id: list.getItems()[0].getTitle()                                                                                                                                                                                                                        
					});                                                                                                                                                                                                                                                       
			}                                                                                                                                                                                                                                                           
		}                                                                                                                                                                                                                                                            
	});                                                                                                                                                                                                                                                           
});                                                                                                                                                                                                                                                            